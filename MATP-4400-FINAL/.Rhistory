scale_fill_brewer(palette = "RdYlBu", labels= vlabel, direction=-1)
smoke_2<- ggplot(data = us_msmoking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(vgroup))) +
geom_polygon(color = "gray90", size = 0.2) + coord_quickmap() +
theme_map()+labs(title = "US Male Smoking Disparity")+labs(fill = "Smoking Disparity") +
scale_fill_brewer(palette = "RdYlBu", labels= vlabel, direction=-1)
plot_grid(smoke_1, smoke_2, ncol = 1)
# Plot femake and male COVID 19 death disparity
dlabel<- c("-5 to -2", "-2 to -1", "-1 to -.2", "-.2 to .2", ".2 to 1", "1 to 2", "2 to 5", "NA")
covid_1<- ggplot(data = us_fsmoking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(dgroup))) +
geom_polygon(color = "gray90", size = 0.2) + coord_quickmap() +
theme_map()+labs(title = "US Female COVID 19 Death Disparity")+labs(fill = "Death Disparity") +
scale_fill_brewer(palette = "RdYlBu", labels= dlabel, direction=-1)
covid_2<- ggplot(data = us_msmoking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(dgroup))) +
geom_polygon(color = "gray90", size = 0.2) + coord_quickmap() +
theme_map()+labs(title = "US Male COVID 19 Death Disparity")+labs(fill = "Death Disparity") +
scale_fill_brewer(palette = "RdYlBu", labels= dlabel, direction=-1)
plot_grid(covid_1, covid_2, ncol = 1)
abb<- state.abb[match(us_states$region,tolower(all_states))]
View(US_death)
View(death_count)
us_states$subregion<- lapply(us_states$region, state.abb, match(us_states$region,tolower(all_states))
us_states$subregion<- lapply(us_states$region, state.abb, match(us_states$region,tolower(all_states)))
# state.abb[match(us_states$region,tolower(all_states))]
us_fsmoking<- left_join(us_states, fsmoking.df)
us_states$subregion<- lapply(us_states$region, state.abb, match(us_states$region,tolower(all_states)))
f1<- function(x,y){
state.abb[match(x,y)]
}
us_states$subregion<- lapply(us_states$region, f1, y=tolower(all_states))
View(US_smoking)
View(us_states)
state.name
us_states$abbrev <- state.abb[us_states$region]
View(us_states)
us_states$abbrev <- state.abb[toupper(us_states$region)]
View(us_states)
toupper(us_states$region)[1]
install.packages("Hmisc")
library(Hmisc)
us_states$abbrev <- state.abb[capitalize(us_states$region)]
View(us_states)
capitalize(us_states$region)[1]
state.abb[capitalize(us_states$region)]
state.abb[capitalize(us_states$region),]
us_states$abbrev <- state.abb[match(capitalize(us_states$region), state.name)]
View(us_states)
# US_smoking value is the median value of states and DC
US_smoking<- US_behavior %>% filter(grepl(paste("Smoking", collapse="|"), Measure.Name))
smoking.df<- behaviors_sex.df %>%
filter(grepl(paste("Smoking", collapse="|"), Measure.Name))
smoking.df$value.disparity<- log(smoking.df$Value/US_smoking$Value)
fsmoking.df<- smoking.df %>%
filter(grepl(paste("Female", collapse="|"), Measure.Name)) %>%
mutate(death.disparity= fdeath.df$death.disparity) %>%
mutate(dgroup= fdeath.df$dgroup)
fsmoking.df$region<- tolower(fsmoking.df$State.Name)
fsmoking.df$vgroup<- as.numeric(cut(fsmoking.df$value.disparity, breaks = vcut_by))
msmoking.df<- smoking.df %>%
filter(grepl(paste("Male", collapse="|"), Measure.Name)) %>%
mutate(death.disparity= mdeath.df$death.disparity) %>%
mutate(dgroup= mdeath.df$dgroup)
msmoking.df$region<- tolower(msmoking.df$State.Name)
msmoking.df$vgroup<- as.numeric(cut(msmoking.df$value.disparity, breaks = vcut_by))
us_states<- map_data("state")
us_states$abbrev <- state.abb[match(capitalize(us_states$region), state.name)]
us_fsmoking<- left_join(us_states, fsmoking.df)
us_msmoking<- left_join(us_states, msmoking.df)
cnames <- aggregate(cbind(long, lat) ~ abbrev, data=us_fsmoking,
FUN=function(x)mean(range(x)))
# Plot female and male smoking disparity
smoke_1<- ggplot(data = us_fsmoking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(vgroup))) +
geom_polygon(color = "gray90", size = 0.2) +
with(cnames, annotate(geom="text", x = long, y=lat, label = abbrev, size = 2.5))+ coord_quickmap() +
theme_map()+labs(title = "US Female Smoking Disparity")+labs(fill = "Smoking Disparity") +
scale_fill_brewer(palette = "RdYlBu", labels= vlabel, direction=-1)
smoke_2<- ggplot(data = us_msmoking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(vgroup))) +
geom_polygon(color = "gray90", size = 0.2) + coord_quickmap() +
theme_map()+labs(title = "US Male Smoking Disparity")+labs(fill = "Smoking Disparity") +
scale_fill_brewer(palette = "RdYlBu", labels= vlabel, direction=-1)
plot_grid(smoke_1, smoke_2, ncol = 1)
# Plot femake and male COVID 19 death disparity
dlabel<- c("-5 to -2", "-2 to -1", "-1 to -.2", "-.2 to .2", ".2 to 1", "1 to 2", "2 to 5", "NA")
covid_1<- ggplot(data = us_fsmoking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(dgroup))) +
geom_polygon(color = "gray90", size = 0.2) + coord_quickmap() +
theme_map()+labs(title = "US Female COVID 19 Death Disparity")+labs(fill = "Death Disparity") +
scale_fill_brewer(palette = "RdYlBu", labels= dlabel, direction=-1)
covid_2<- ggplot(data = us_msmoking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(dgroup))) +
geom_polygon(color = "gray90", size = 0.2) + coord_quickmap() +
theme_map()+labs(title = "US Male COVID 19 Death Disparity")+labs(fill = "Death Disparity") +
scale_fill_brewer(palette = "RdYlBu", labels= dlabel, direction=-1)
plot_grid(covid_1, covid_2, ncol = 1)
state.abb[capitalize(us_states$region)]
capitalize("new york")
install.packages("tools")
library(tools)
library(tools)
us_states$abbrev <- state.abb[match(toTitleCase(us_states$region), state.name)]
View(us_states)
# US_smoking value is the median value of states and DC
US_smoking<- US_behavior %>% filter(grepl(paste("Smoking", collapse="|"), Measure.Name))
smoking.df<- behaviors_sex.df %>%
filter(grepl(paste("Smoking", collapse="|"), Measure.Name))
smoking.df$value.disparity<- log(smoking.df$Value/US_smoking$Value)
fsmoking.df<- smoking.df %>%
filter(grepl(paste("Female", collapse="|"), Measure.Name)) %>%
mutate(death.disparity= fdeath.df$death.disparity) %>%
mutate(dgroup= fdeath.df$dgroup)
fsmoking.df$region<- tolower(fsmoking.df$State.Name)
fsmoking.df$vgroup<- as.numeric(cut(fsmoking.df$value.disparity, breaks = vcut_by))
msmoking.df<- smoking.df %>%
filter(grepl(paste("Male", collapse="|"), Measure.Name)) %>%
mutate(death.disparity= mdeath.df$death.disparity) %>%
mutate(dgroup= mdeath.df$dgroup)
msmoking.df$region<- tolower(msmoking.df$State.Name)
msmoking.df$vgroup<- as.numeric(cut(msmoking.df$value.disparity, breaks = vcut_by))
us_states<- map_data("state")
us_states$abbrev <- state.abb[match(toTitleCase(us_states$region), state.name)]
us_fsmoking<- left_join(us_states, fsmoking.df)
us_msmoking<- left_join(us_states, msmoking.df)
cnames <- aggregate(cbind(long, lat) ~ abbrev, data=us_fsmoking,
FUN=function(x)mean(range(x)))
# Plot female and male smoking disparity
smoke_1<- ggplot(data = us_fsmoking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(vgroup))) +
geom_polygon(color = "gray90", size = 0.2) +
with(cnames, annotate(geom="text", x = long, y=lat, label = abbrev, size = 2.5))+ coord_quickmap() +
theme_map()+labs(title = "US Female Smoking Disparity")+labs(fill = "Smoking Disparity") +
scale_fill_brewer(palette = "RdYlBu", labels= vlabel, direction=-1)
smoke_2<- ggplot(data = us_msmoking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(vgroup))) +
geom_polygon(color = "gray90", size = 0.2) + coord_quickmap() +
theme_map()+labs(title = "US Male Smoking Disparity")+labs(fill = "Smoking Disparity") +
scale_fill_brewer(palette = "RdYlBu", labels= vlabel, direction=-1)
plot_grid(smoke_1, smoke_2, ncol = 1)
# Plot femake and male COVID 19 death disparity
dlabel<- c("-5 to -2", "-2 to -1", "-1 to -.2", "-.2 to .2", ".2 to 1", "1 to 2", "2 to 5", "NA")
covid_1<- ggplot(data = us_fsmoking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(dgroup))) +
geom_polygon(color = "gray90", size = 0.2) + coord_quickmap() +
theme_map()+labs(title = "US Female COVID 19 Death Disparity")+labs(fill = "Death Disparity") +
scale_fill_brewer(palette = "RdYlBu", labels= dlabel, direction=-1)
covid_2<- ggplot(data = us_msmoking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(dgroup))) +
geom_polygon(color = "gray90", size = 0.2) + coord_quickmap() +
theme_map()+labs(title = "US Male COVID 19 Death Disparity")+labs(fill = "Death Disparity") +
scale_fill_brewer(palette = "RdYlBu", labels= dlabel, direction=-1)
plot_grid(covid_1, covid_2, ncol = 1)
smoke_1<- ggplot(data = us_fsmoking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(vgroup))) +
geom_polygon(color = "gray90", size = 0.2) +
with(cnames, annotate(geom="text", x = long, y=lat, label = abbrev, size = 2.5))+ coord_quickmap() +
theme_map()+labs(title = "US Female Smoking Disparity")+labs(fill = "Smoking Disparity") +
scale_fill_brewer(palette = "RdYlBu", labels= vlabel, direction=-1)
smoke_2<- ggplot(data = us_msmoking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(vgroup))) +
geom_polygon(color = "gray90", size = 0.2) +
with(cnames, annotate(geom="text", x = long, y=lat, label = abbrev, size = 2.5))+ coord_quickmap() +
theme_map()+labs(title = "US Male Smoking Disparity")+labs(fill = "Smoking Disparity") +
scale_fill_brewer(palette = "RdYlBu", labels= vlabel, direction=-1)
plot_grid(smoke_1, smoke_2, ncol = 1)
# Plot femake and male COVID 19 death disparity
dlabel<- c("-5 to -2", "-2 to -1", "-1 to -.2", "-.2 to .2", ".2 to 1", "1 to 2", "2 to 5", "NA")
covid_1<- ggplot(data = us_fsmoking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(dgroup))) +
geom_polygon(color = "gray90", size = 0.2) +
with(cnames, annotate(geom="text", x = long, y=lat, label = abbrev, size = 2.5))+ coord_quickmap() +
theme_map()+labs(title = "US Female COVID 19 Death Disparity")+labs(fill = "Death Disparity") +
scale_fill_brewer(palette = "RdYlBu", labels= dlabel, direction=-1)
covid_2<- ggplot(data = us_msmoking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(dgroup))) +
geom_polygon(color = "gray90", size = 0.2) +
with(cnames, annotate(geom="text", x = long, y=lat, label = abbrev, size = 2.5))+ coord_quickmap() +
theme_map()+labs(title = "US Male COVID 19 Death Disparity")+labs(fill = "Death Disparity") +
scale_fill_brewer(palette = "RdYlBu", labels= dlabel, direction=-1)
plot_grid(covid_1, covid_2, ncol = 1)
# US_drinking value is the median value of states and DC
US_drinking<- US_behavior %>% filter(grepl(paste("Excessive Drinking", collapse="|"), Measure.Name))
# Filter out information about excessive drinking
drinking.df<- behaviors_sex.df %>%
filter(grepl(paste("Excessive Drinking", collapse="|"), Measure.Name))
drinking.df$value.disparity<- log(drinking.df$Value/US_drinking$Value)
# Separate excessive drinking data by geneder
fdrinking.df<- drinking.df %>%
filter(grepl(paste("Female", collapse="|"), Measure.Name))
fdrinking.df$region<- tolower(fdrinking.df$State.Name)
fdrinking.df$vgroup<- as.numeric(cut(fdrinking.df$value.disparity, breaks = vcut_by))
# Merge US map data and excessive drinking data for female and male
mdrinking.df<- drinking.df %>%
filter(grepl(paste("Male", collapse="|"), Measure.Name))
mdrinking.df$region<- tolower(mdrinking.df$State.Name)
mdrinking.df$vgroup<- as.numeric(cut(mdrinking.df$value.disparity, breaks = vcut_by))
# Merge US map data and excessive drinking data for female and male
us_fdrinking<- left_join(us_states, fdrinking.df)
us_mdrinking<- left_join(us_states, mdrinking.df)
# Plot femake and male excessive drinking disparity
drinking_1<- ggplot(data = us_fdrinking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(vgroup))) +
geom_polygon(color = "white", size = 0.2) +
with(cnames, annotate(geom="text", x = long, y=lat, label = abbrev, size = 2.5))+ coord_quickmap() +
theme_map()+labs(title = "US Female Excessive Drinking Disparity")+labs(fill = "Excessive Drinking Disparity") +
scale_fill_brewer(palette = "RdYlBu", labels= vlabel, direction=-1)
drinking_2<- ggplot(data = us_mdrinking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(vgroup))) +
geom_polygon(color = "white", size = 0.2) +
with(cnames, annotate(geom="text", x = long, y=lat, label = abbrev, size = 2.5))+ coord_quickmap() +
theme_map()+labs(title = "US Male Excessive Drinking Disparity")+labs(fill = "Excessive Drinking Disparity") +
scale_fill_brewer(palette = "RdYlBu", labels= vlabel, direction=-1)
# Combine the two maps
plot_grid(drinking_1, drinking_2, ncol = 1)
# US_drinking value is the median value of states and DC
US_drinking<- US_behavior %>% filter(grepl(paste("Excessive Drinking", collapse="|"), Measure.Name))
# Filter out information about excessive drinking
drinking.df<- behaviors_sex.df %>%
filter(grepl(paste("Excessive Drinking", collapse="|"), Measure.Name))
drinking.df$value.disparity<- log(drinking.df$Value/US_drinking$Value)
# Separate excessive drinking data by geneder
fdrinking.df<- drinking.df %>%
filter(grepl(paste("Female", collapse="|"), Measure.Name))
fdrinking.df$region<- tolower(fdrinking.df$State.Name)
fdrinking.df$vgroup<- as.numeric(cut(fdrinking.df$value.disparity, breaks = vcut_by))
# Merge US map data and excessive drinking data for female and male
mdrinking.df<- drinking.df %>%
filter(grepl(paste("Male", collapse="|"), Measure.Name))
mdrinking.df$region<- tolower(mdrinking.df$State.Name)
mdrinking.df$vgroup<- as.numeric(cut(mdrinking.df$value.disparity, breaks = vcut_by))
# Merge US map data and excessive drinking data for female and male
us_fdrinking<- left_join(us_states, fdrinking.df)
us_mdrinking<- left_join(us_states, mdrinking.df)
# Plot femake and male excessive drinking disparity
drinking_1<- ggplot(data = us_fdrinking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(vgroup))) +
geom_polygon(color = "white", size = 0.2) +
with(cnames, annotate(geom="text", x = long, y=lat, label = abbrev, size = 2.5))+ coord_quickmap() +
theme_map()+labs(title = "US Female Excessive Drinking Disparity")+labs(fill = "Excessive Drinking Disparity") +
scale_fill_brewer(palette = "RdYlBu", labels= vlabel, direction=-1)
drinking_2<- ggplot(data = us_mdrinking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(vgroup))) +
geom_polygon(color = "white", size = 0.2) +
with(cnames, annotate(geom="text", x = long, y=lat, label = abbrev, size = 2.5))+ coord_quickmap() +
theme_map()+labs(title = "US Male Excessive Drinking Disparity")+labs(fill = "Excessive Drinking Disparity") +
scale_fill_brewer(palette = "RdYlBu", labels= vlabel, direction=-1)
# Combine the two maps
plot_grid(drinking_1, drinking_2, ncol = 1)
summary(finactivity.df$value.disparity)
summary(fdrinking.df$value.disparity)
# stick libraries here
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(maps)
library(cowplot)
library(tools)
# US_smoking value is the median value of states and DC
US_smoking<- US_behavior %>% filter(grepl(paste("Smoking", collapse="|"), Measure.Name))
# Filter out information about smoking
smoking.df<- behaviors_sex.df %>%
filter(grepl(paste("Smoking", collapse="|"), Measure.Name))
# Calculate the disparity index of each state's smoking percentage against the US value
smoking.df$value.disparity<- log(smoking.df$Value/US_smoking$Value)
# Separate smoking data by geneder
fsmoking.df<- smoking.df %>%
filter(grepl(paste("Female", collapse="|"), Measure.Name)) %>%
# Add COVID 19 death disparity
mutate(death.disparity= fdeath.df$death.disparity) %>%
mutate(dgroup= fdeath.df$dgroup)
fsmoking.df$region<- tolower(fsmoking.df$State.Name)
# Bin size for smoking disparity
vcut_by<- c(-1,-.5,-.3,-.15,0,.15,.3,.5,1)
# Categorize smoking percentage into 8 groups
fsmoking.df$vgroup<- as.numeric(cut(fsmoking.df$value.disparity, breaks = vcut_by))
msmoking.df<- smoking.df %>%
filter(grepl(paste("Male", collapse="|"), Measure.Name)) %>%
mutate(death.disparity= mdeath.df$death.disparity) %>%
mutate(dgroup= mdeath.df$dgroup)
msmoking.df$region<- tolower(msmoking.df$State.Name)
msmoking.df$vgroup<- as.numeric(cut(msmoking.df$value.disparity, breaks = vcut_by))
# Access US map data from library(map)
us_states<- map_data("state")
# Abbreviate state names so the names can fit on the map
us_states$abbrev <- state.abb[match(toTitleCase(us_states$region), state.name)]
# Merge US map data and smoking data for female and male
us_fsmoking<- left_join(us_states, fsmoking.df)
us_msmoking<- left_join(us_states, msmoking.df)
# Use to locate state labels on the map
cnames <- aggregate(cbind(long, lat) ~ abbrev, data=us_fsmoking,
FUN=function(x)mean(range(x)))
# Plot female and male smoking disparity
vlabel<- c("-1 to -.5", "-.5 to -.25", "-.25 to -.1", "-.1 to 0", "0 to .1", ".1 to .25", ".25 to .5", ".5 to 1")
smoke_1<- ggplot(data = us_fsmoking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(vgroup))) +
geom_polygon(color = "white", size = 0.2) +
with(cnames, annotate(geom="text", x = long, y=lat, label = abbrev, size = 2.5))+ coord_quickmap() +
theme_map()+labs(title = "US Female Smoking Disparity")+labs(fill = "Smoking Disparity") +
scale_fill_brewer(palette = "RdYlBu", labels= vlabel, direction=-1)
smoke_2<- ggplot(data = us_msmoking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(vgroup))) +
geom_polygon(color = "white", size = 0.2) +
with(cnames, annotate(geom="text", x = long, y=lat, label = abbrev, size = 2.5))+ coord_quickmap() +
theme_map()+labs(title = "US Male Smoking Disparity")+labs(fill = "Smoking Disparity") +
scale_fill_brewer(palette = "RdYlBu", labels= vlabel, direction=-1)
# Combine the two maps
plot_grid(smoke_1, smoke_2, ncol = 1)
# Plot female and male COVID 19 death disparity
dlabel<- c("-5 to -2", "-2 to -1", "-1 to -.2", "-.2 to .2", ".2 to 1", "1 to 2", "2 to 5", "NA")
covid_1<- ggplot(data = us_fsmoking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(dgroup))) +
geom_polygon(color = "white", size = 0.2) +
with(cnames, annotate(geom="text", x = long, y=lat, label = abbrev, size = 2.5))+ coord_quickmap() +
theme_map()+labs(title = "US Female COVID 19 Death Disparity")+labs(fill = "Death Disparity") +
scale_fill_brewer(palette = "RdYlBu", labels= dlabel, direction=-1)
covid_2<- ggplot(data = us_msmoking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(dgroup))) +
geom_polygon(color = "white", size = 0.2) +
with(cnames, annotate(geom="text", x = long, y=lat, label = abbrev, size = 2.5))+ coord_quickmap() +
theme_map()+labs(title = "US Male COVID 19 Death Disparity")+labs(fill = "Death Disparity") +
scale_fill_brewer(palette = "RdYlBu", labels= dlabel, direction=-1)
# Combine the two maps
plot_grid(covid_1, covid_2, ncol = 1)
dlabel<- c("-5 to -2", "-2 to -1", "-1 to -.2", "-.2 to .2", ".2 to 1", "1 to 2", "2 to 5", "NA")
covid_1<- ggplot(data = us_fsmoking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(dgroup))) +
geom_polygon(color = "gray30", size = 0.2) +
with(cnames, annotate(geom="text", x = long, y=lat, label = abbrev, size = 2.5))+ coord_quickmap() +
theme_map()+labs(title = "US Female COVID 19 Death Disparity")+labs(fill = "Death Disparity") +
scale_fill_brewer(palette = "RdYlBu", labels= dlabel, direction=-1)
covid_2<- ggplot(data = us_msmoking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(dgroup))) +
geom_polygon(color = "gray30", size = 0.2) +
with(cnames, annotate(geom="text", x = long, y=lat, label = abbrev, size = 2.5))+ coord_quickmap() +
theme_map()+labs(title = "US Male COVID 19 Death Disparity")+labs(fill = "Death Disparity") +
scale_fill_brewer(palette = "RdYlBu", labels= dlabel, direction=-1)
# Combine the two maps
plot_grid(covid_1, covid_2, ncol = 1)
# Plot female and male COVID 19 death disparity
dlabel<- c("-5 to -2", "-2 to -1", "-1 to -.2", "-.2 to .2", ".2 to 1", "1 to 2", "2 to 5", "NA")
covid_1<- ggplot(data = us_fsmoking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(dgroup))) +
geom_polygon(color = "gray90", size = 0.2) +
with(cnames, annotate(geom="text", x = long, y=lat, label = abbrev, size = 2.5))+ coord_quickmap() +
theme_map()+labs(title = "US Female COVID 19 Death Disparity")+labs(fill = "Death Disparity") +
scale_fill_brewer(palette = "RdYlBu", labels= dlabel, direction=-1)
covid_2<- ggplot(data = us_msmoking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(dgroup))) +
geom_polygon(color = "gray90", size = 0.2) +
with(cnames, annotate(geom="text", x = long, y=lat, label = abbrev, size = 2.5))+ coord_quickmap() +
theme_map()+labs(title = "US Male COVID 19 Death Disparity")+labs(fill = "Death Disparity") +
scale_fill_brewer(palette = "RdYlBu", labels= dlabel, direction=-1)
# Combine the two maps
plot_grid(covid_1, covid_2, ncol = 1)
View(all_states.df)
all_states
unique(all_states.df$Measure.Name)
# stick libraries here
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(maps)
library(cowplot)
library(tools)
# Read in the entire 2019 report from America's Health Ranking.
all_states.df <- read.csv("~/COVID-Notebooks/data/2019-Annual.csv")
all_states<- unique(all_states.df$State.Name) %>% sort()
# Sort data frame by states
all_states.df<- all_states.df %>%
arrange(factor(all_states.df$State.Name, levels = all_states))
# Pick data for specific health behaviors as topics of this project
behaviors<- c("Smoking", "Physical Inactivity", "Excessive Drinking")
behaviors.df <- filter(all_states.df, grepl(paste(behaviors, collapse="|"), Measure.Name))
# Filter out only the data that contain information with sex
sex<- c("Female", "Male")
behaviors_sex.df<- behaviors.df %>%
filter(grepl(paste(sex, collapse="|"), Measure.Name)) %>%
select(State.Name, Measure.Name, Value)
# Pick and remove the data pertaining to United States
US_behavior<- behaviors_sex.df[behaviors_sex.df$State.Name == "United States", ]
behaviors_sex.df<- behaviors_sex.df[behaviors_sex.df$State.Name != "United States", ]
# Read in data about COVID 19 death
death_count<- read.csv("~/COVID-Notebooks/data/csv/Provisional_COVID-19_Death_Counts_by_Sex__Age__and_State.csv")
# Choose data that contains information about sex
pick<- c("Male Total", "Female Total")
death_count<- death_count %>%
filter(grepl(paste(pick, collapse="|"), Sex)) %>%
select(State, Sex, COVID.19.Deaths)
US_death<- death_count[death_count$State == "United States", ]
NYC_death<- death_count[death_count$State == "New York City", ]
# Remove irrelevant data
drop <- c("United States", "New York City", "Puerto Rico")
death_count<- death_count[!(death_count$State %in% drop), ]
row.names(death_count) <- NULL
# Add COVID 19 death information for NYC to NY's data for COVID 19 death
n<- which(grepl("New York", death_count$State))
death_count$COVID.19.Deaths[n[1]]<- death_count$COVID.19.Deaths[n[1]] + NYC_death$COVID.19.Deaths[1]
death_count$COVID.19.Deaths[n[2]]<- death_count$COVID.19.Deaths[n[2]] + NYC_death$COVID.19.Deaths[2]
# Calculate the average number of COVID 19 death for female and male
fmean_death<- US_death$COVID.19.Deaths[2]/53 # Divide by 53 because district of columbia and NYC counted is counted separately
mmean_death<- US_death$COVID.19.Deaths[1]/53
US_death$mean_death<- c(fmean_death, mmean_death)
# Calculate the disparity index of each state's COVID 19 death count against the US value
death_count$death.disparity<- log(death_count$COVID.19.Deaths/US_death$mean_death)
# Reverse every two row from male, female to female, male to match the ordering for the health behavior data set
death_count<- death_count[c(rbind(seq(2, nrow(death_count), 2), seq(1, nrow(death_count), 2))),]
# Categorize COVID 19 death count into 8 groups for female and male
dcut_by<- c(5, 2, 1, .2, -.2, -1, -2, -5)
fdeath.df<- death_count %>% filter(grepl(paste("Female", collapse="|"), Sex))
fdeath.df$dgroup<- as.numeric(cut(fdeath.df$death.disparity, breaks = dcut_by))
mdeath.df<- death_count %>% filter(grepl(paste("Male", collapse="|"), Sex))
mdeath.df$dgroup<- as.numeric(cut(mdeath.df$death.disparity, breaks = dcut_by))
# US_smoking value is the median value of states and DC
US_smoking<- US_behavior %>% filter(grepl(paste("Smoking", collapse="|"), Measure.Name))
# Filter out information about smoking
smoking.df<- behaviors_sex.df %>%
filter(grepl(paste("Smoking", collapse="|"), Measure.Name))
# Calculate the disparity index of each state's smoking percentage against the US value
smoking.df$value.disparity<- log(smoking.df$Value/US_smoking$Value)
# Separate smoking data by geneder
fsmoking.df<- smoking.df %>%
filter(grepl(paste("Female", collapse="|"), Measure.Name)) %>%
# Add COVID 19 death disparity
mutate(death.disparity= fdeath.df$death.disparity) %>%
mutate(dgroup= fdeath.df$dgroup)
fsmoking.df$region<- tolower(fsmoking.df$State.Name)
# Bin size for smoking disparity
vcut_by<- c(-1,-.5,-.3,-.15,0,.15,.3,.5,1)
# Categorize smoking percentage into 8 groups
fsmoking.df$vgroup<- as.numeric(cut(fsmoking.df$value.disparity, breaks = vcut_by))
msmoking.df<- smoking.df %>%
filter(grepl(paste("Male", collapse="|"), Measure.Name)) %>%
mutate(death.disparity= mdeath.df$death.disparity) %>%
mutate(dgroup= mdeath.df$dgroup)
msmoking.df$region<- tolower(msmoking.df$State.Name)
msmoking.df$vgroup<- as.numeric(cut(msmoking.df$value.disparity, breaks = vcut_by))
# Access US map data from library(map)
us_states<- map_data("state")
# Abbreviate state names so the names can fit on the map
us_states$abbrev <- state.abb[match(toTitleCase(us_states$region), state.name)]
# Merge US map data and smoking data for female and male
us_fsmoking<- left_join(us_states, fsmoking.df)
us_msmoking<- left_join(us_states, msmoking.df)
# Use to locate state labels on the map
cnames <- aggregate(cbind(long, lat) ~ abbrev, data=us_fsmoking,
FUN=function(x)mean(range(x)))
# Plot female and male smoking disparity
vlabel<- c("-1 to -.5", "-.5 to -.3", "-.3 to -.15", "-.15 to 0", "0 to .15", ".15 to .3", ".3 to .5", ".5 to 1")
smoke_1<- ggplot(data = us_fsmoking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(vgroup))) +
geom_polygon(color = "gray90", size = 0.2) +
with(cnames, annotate(geom="text", x = long, y=lat, label = abbrev, size = 2.5))+ coord_quickmap() +
theme_map()+labs(title = "US Female Smoking Disparity Index")+labs(fill = "Disparity Index") +
scale_fill_brewer(palette = "RdYlBu", labels= vlabel, direction=-1)
smoke_2<- ggplot(data = us_msmoking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(vgroup))) +
geom_polygon(color = "gray90", size = 0.2) +
with(cnames, annotate(geom="text", x = long, y=lat, label = abbrev, size = 2.5))+ coord_quickmap() +
theme_map()+labs(title = "US Male Smoking Disparity Index")+labs(fill = "Disparity Index") +
scale_fill_brewer(palette = "RdYlBu", labels= vlabel, direction=-1)
# Combine the two maps
plot_grid(smoke_1, smoke_2, ncol = 1)
# Plot female and male COVID 19 death disparity
dlabel<- c("-5 to -2", "-2 to -1", "-1 to -.2", "-.2 to .2", ".2 to 1", "1 to 2", "2 to 5", "NA")
covid_1<- ggplot(data = us_fsmoking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(dgroup))) +
geom_polygon(color = "gray90", size = 0.2) +
with(cnames, annotate(geom="text", x = long, y=lat, label = abbrev, size = 2.5))+ coord_quickmap() +
theme_map()+labs(title = "US Female COVID 19 Death Disparity Index")+labs(fill = "Disparity Index") +
scale_fill_brewer(palette = "RdYlBu", labels= dlabel, direction=-1)
covid_2<- ggplot(data = us_msmoking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(dgroup))) +
geom_polygon(color = "gray90", size = 0.2) +
with(cnames, annotate(geom="text", x = long, y=lat, label = abbrev, size = 2.5))+ coord_quickmap() +
theme_map()+labs(title = "US Male COVID 19 Death Disparity Index")+labs(fill = "Disparity Index") +
scale_fill_brewer(palette = "RdYlBu", labels= dlabel, direction=-1)
# Combine the two maps
plot_grid(covid_1, covid_2, ncol = 1)
# US_inactivity value is the median value of states and DC
US_inactivity<- US_behavior %>% filter(grepl(paste("Physical Inactivity", collapse="|"), Measure.Name))
# Filter out information about physical inactivity
inactivity.df<- behaviors_sex.df %>%
filter(grepl(paste("Physical Inactivity", collapse="|"), Measure.Name))
inactivity.df$value.disparity<- log(inactivity.df$Value/US_inactivity$Value)
# Separate physical inactivity data by geneder
finactivity.df<- inactivity.df %>%
filter(grepl(paste("Female", collapse="|"), Measure.Name))
finactivity.df$region<- tolower(finactivity.df$State.Name)
finactivity.df$vgroup<- as.numeric(cut(finactivity.df$value.disparity, breaks = vcut_by))
minactivity.df<- inactivity.df %>%
filter(grepl(paste("Male", collapse="|"), Measure.Name))
minactivity.df$region<- tolower(minactivity.df$State.Name)
minactivity.df$vgroup<- as.numeric(cut(minactivity.df$value.disparity, breaks = vcut_by))
# Merge US map data and physical inactivity data for female and male
us_finactivity<- left_join(us_states, finactivity.df)
us_minactivity<- left_join(us_states, minactivity.df)
# Plot femake and male physical inactivity disparity
inactivity_1<- ggplot(data = us_finactivity, mapping= aes(x= long, y= lat, group= group, fill= as.factor(vgroup))) +
geom_polygon(color = "gray90", size = 0.2) +
with(cnames, annotate(geom="text", x = long, y=lat, label = abbrev, size = 2.5))+ coord_quickmap() +
theme_map()+labs(title = "US Female Physical Inactivity Disparity Index")+labs(fill = "Disparity Index") +
scale_fill_brewer(palette = "RdYlBu", labels= vlabel, direction=-1)
inactivity_2<- ggplot(data = us_minactivity, mapping= aes(x= long, y= lat, group= group, fill= as.factor(vgroup))) +
geom_polygon(color = "gray90", size = 0.2) +
with(cnames, annotate(geom="text", x = long, y=lat, label = abbrev, size = 2.5))+ coord_quickmap() +
theme_map()+labs(title = "US Male Physical Inactivity Disparity Index")+labs(fill = "Disparity Index") +
scale_fill_brewer(palette = "RdYlBu", labels= vlabel, direction=-1)
# Combine the two maps
plot_grid(inactivity_1, inactivity_2, ncol = 1)
# US_drinking value is the median value of states and DC
US_drinking<- US_behavior %>% filter(grepl(paste("Excessive Drinking", collapse="|"), Measure.Name))
# Filter out information about excessive drinking
drinking.df<- behaviors_sex.df %>%
filter(grepl(paste("Excessive Drinking", collapse="|"), Measure.Name))
drinking.df$value.disparity<- log(drinking.df$Value/US_drinking$Value)
# Separate excessive drinking data by geneder
fdrinking.df<- drinking.df %>%
filter(grepl(paste("Female", collapse="|"), Measure.Name))
fdrinking.df$region<- tolower(fdrinking.df$State.Name)
fdrinking.df$vgroup<- as.numeric(cut(fdrinking.df$value.disparity, breaks = vcut_by))
# Merge US map data and excessive drinking data for female and male
mdrinking.df<- drinking.df %>%
filter(grepl(paste("Male", collapse="|"), Measure.Name))
mdrinking.df$region<- tolower(mdrinking.df$State.Name)
mdrinking.df$vgroup<- as.numeric(cut(mdrinking.df$value.disparity, breaks = vcut_by))
# Merge US map data and excessive drinking data for female and male
us_fdrinking<- left_join(us_states, fdrinking.df)
us_mdrinking<- left_join(us_states, mdrinking.df)
# Plot femake and male excessive drinking disparity
drinking_1<- ggplot(data = us_fdrinking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(vgroup))) +
geom_polygon(color = "white", size = 0.2) +
with(cnames, annotate(geom="text", x = long, y=lat, label = abbrev, size = 2.5))+ coord_quickmap() +
theme_map()+labs(title = "US Female Excessive Drinking Disparity Index")+labs(fill = "Disparity Index") +
scale_fill_brewer(palette = "RdYlBu", labels= vlabel, direction=-1)
drinking_2<- ggplot(data = us_mdrinking, mapping = aes(x = long, y = lat, group = group, fill = as.factor(vgroup))) +
geom_polygon(color = "white", size = 0.2) +
with(cnames, annotate(geom="text", x = long, y=lat, label = abbrev, size = 2.5))+ coord_quickmap() +
theme_map()+labs(title = "US Male Excessive Drinking Disparity Index")+labs(fill = "Disparity Index") +
scale_fill_brewer(palette = "RdYlBu", labels= vlabel, direction=-1)
# Combine the two maps
plot_grid(drinking_1, drinking_2, ncol = 1)
