knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "../")
source("./Modules/Source.R")
# Change the date here
date_of_study = "06-28-2020"
column_names <- data.frame()
# MortalityMinder datesets
#------------------------------------------------------------------------------------------------------------------------------------------
# CDC
# Used column
#-------------------------------------------------------------------------------------------------
#| All.Cause.county_fips         | All.Cause.death_rate          | Assault.death_rate            |
#-------------------------------------------------------------------------------------------------
#| Cancer.death_rate             | Cardiovascular.death_rate     | Despair.death_rate            |
#-------------------------------------------------------------------------------------------------
# Unused columns
#-------------------------------------------------------------------------------------------------
#| All.Cause.urban_2013          | All.Cause.population          | All.Cause.death_num           |
#-------------------------------------------------------------------------------------------------
#| Assault.death_num             | Cancer.death_num              | Cardiovascular.death_num      |
#-------------------------------------------------------------------------------------------------
#| Despair.death_num             |
#---------------------------------
cdc <- readRDS('MM_data/data/CDC/cdc.data.imputed.Rds')
cdc <- subset(cdc, period == '2015-2017')
cdc <- data.frame(split(cdc, cdc$death_cause))
cdc <- subset(cdc, select = c(All.Cause.county_fips,
All.Cause.death_rate,
Assault.death_rate,
Cancer.death_rate,
Cardiovascular.death_rate,
Despair.death_rate))
cdc <- rename(cdc, c(FIPS = All.Cause.county_fips))
cdc_names <- data.frame(column = names(cdc)[2:6])
cdc_names$source <- "cdc"
column_names <- rbind(column_names, cdc_names)
# Social Determinants datesets
#------------------------------------------------------------------------------------------------------------------------------------------
# County Health Rankings Master dataset
# Used columns
#-------------------------------------------------------------------------------------------------
#| FIPS                          | `% Adults with Diabetes`      | `% Adults with Obesity`       |
#-------------------------------------------------------------------------------------------------
#| `% 65 and over`               | `Age-Adjusted Death Rate`     |
#-----------------------------------------------------------------
# Unused columns
#-------------------------------------------------------------------------------------------------
#| `% Smokers`                                   | `% Excessive Drinking`                        |
#-------------------------------------------------------------------------------------------------
#| `Average Daily PM2.5`                         | `% Fair or Poor Health`                       |
#-------------------------------------------------------------------------------------------------
chr <- read_csv("Data/2020CHR.csv")
chr <- chr[, -grep("Quartile", colnames(chr))]
chr <- chr[, -grep("95", colnames(chr))]
chr <- subset(chr, select = -c(Deaths, Unreliable, ``))
chr <- rename(chr, c("pct_diabetes" = `% Adults with Diabetes`,
"pct_obesity" = `% Adults with Obesity`,
"pct_age65" = `% 65 and over`,
"pre_covid_deaths" = `# Deaths`,
"pre_covid_death_rate" = `Age-Adjusted Death Rate`,
"child_deaths" = `# Deaths_1`,
"infant_deaths" = `# Deaths_2`,
"# less than 18 years of age" = `Population_1`,
"suicide_deaths"= `# Deaths_3`))
chr_names <- data.frame(column = names(chr)[2:238])
chr_names$source <- "chr"
column_names <- rbind(column_names, chr_names)
#------------------------------------------------------------------------------------------------------------------------------------------
# Lung Disease dataset
lungdisease <- read_csv("Data/lungdiseaseestimates_uscounties.csv")
lungdisease$PediatricAsthma         <- lungdisease$PediatricAsthma / lungdisease$TotalPopulation  * 10^5
lungdisease$AdultAsthma             <- lungdisease$AdultAsthma / lungdisease$TotalPopulation  * 10^5
lungdisease$COPD                    <- lungdisease$COPD / lungdisease$TotalPopulation  * 10^5
lungdisease$AdultChronicLungDisease <- lungdisease$AdultChronicLungDisease / lungdisease$TotalPopulation  * 10^5
lungdisease$LungCancer              <- lungdisease$LungCancer / lungdisease$TotalPopulation  * 10^5
lungdisease <- subset(lungdisease, select = -c(`State or County`, TotalPopulation))
lungdisease_names <- data.frame(column = names(lungdisease)[2:6])
lungdisease_names$source <- "lungdisease"
column_names <- rbind(column_names, lungdisease_names)
#------------------------------------------------------------------------------------------------------------------------------------------
# Historical data
covid_hist = read.csv(text=getURL(paste0("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_daily_reports/03-30-2020.csv")))
covid_us_hist = subset(covid_hist, Country_Region == "US" & is.na(FIPS)==F)
#covid_us_hist = subset(covid_us_hist, select = -c(Country_Region, Last_Update, Combined_Key))
# Import outcome data from JHU CSSE
covid = read.csv(text=getURL(paste0("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_daily_reports/",date_of_study,".csv")))
covid_us = subset(covid,Country_Region == "US")
covid_us <- rbind.fill(covid_us,subset(covid_us_hist, (!(FIPS %in% covid_us$FIPS))  & Confirmed == 0 & Deaths == 0 & is.na(FIPS)==F))
covid_us$FIPS = str_pad(covid_us$FIPS, 5, pad = "0")
covid_us = subset(covid_us, select = -c(Admin2, Province_State, Country_Region, Last_Update, Combined_Key))
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "../")
source("./Modules/Source.R")
# Change the date here
date_of_study = "06-28-2020"
column_names <- data.frame()
# MortalityMinder datesets
#------------------------------------------------------------------------------------------------------------------------------------------
# CDC
# Used column
#-------------------------------------------------------------------------------------------------
#| All.Cause.county_fips         | All.Cause.death_rate          | Assault.death_rate            |
#-------------------------------------------------------------------------------------------------
#| Cancer.death_rate             | Cardiovascular.death_rate     | Despair.death_rate            |
#-------------------------------------------------------------------------------------------------
# Unused columns
#-------------------------------------------------------------------------------------------------
#| All.Cause.urban_2013          | All.Cause.population          | All.Cause.death_num           |
#-------------------------------------------------------------------------------------------------
#| Assault.death_num             | Cancer.death_num              | Cardiovascular.death_num      |
#-------------------------------------------------------------------------------------------------
#| Despair.death_num             |
#---------------------------------
cdc <- readRDS('MM_data/data/CDC/cdc.data.imputed.Rds')
cdc <- subset(cdc, period == '2015-2017')
cdc <- data.frame(split(cdc, cdc$death_cause))
cdc <- subset(cdc, select = c(All.Cause.county_fips,
All.Cause.death_rate,
Assault.death_rate,
Cancer.death_rate,
Cardiovascular.death_rate,
Despair.death_rate))
cdc <- rename(cdc, c(FIPS = All.Cause.county_fips))
cdc_names <- data.frame(column = names(cdc)[2:6])
cdc_names$source <- "cdc"
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "../")
source("./Modules/Source.R")
# Change the date here
date_of_study = "06-28-2020"
column_names <- data.frame()
# MortalityMinder datesets
#------------------------------------------------------------------------------------------------------------------------------------------
# CDC
# Used column
#-------------------------------------------------------------------------------------------------
#| All.Cause.county_fips         | All.Cause.death_rate          | Assault.death_rate            |
#-------------------------------------------------------------------------------------------------
#| Cancer.death_rate             | Cardiovascular.death_rate     | Despair.death_rate            |
#-------------------------------------------------------------------------------------------------
# Unused columns
#-------------------------------------------------------------------------------------------------
#| All.Cause.urban_2013          | All.Cause.population          | All.Cause.death_num           |
#-------------------------------------------------------------------------------------------------
#| Assault.death_num             | Cancer.death_num              | Cardiovascular.death_num      |
#-------------------------------------------------------------------------------------------------
#| Despair.death_num             |
#---------------------------------
cdc <- readRDS('MM_data/data/CDC/cdc.data.imputed.Rds')
cdc <- subset(cdc, period == '2015-2017')
cdc <- data.frame(split(cdc, cdc$death_cause))
cdc <- subset(cdc, select = c(All.Cause.county_fips,
All.Cause.death_rate,
Assault.death_rate,
Cancer.death_rate,
Cardiovascular.death_rate,
Despair.death_rate))
cdc <- rename(cdc, c(FIPS = All.Cause.county_fips))
cdc_names <- data.frame(column = names(cdc)[2:6])
cdc_names$source <- "cdc"
